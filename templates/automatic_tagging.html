{% extends 'admin/master.html' %}
<!--{% import "bootstrap/wtf.html" as wtf %}-->

{% block head_tail %}
    {{ super() }}

    <script src="../../static/js/d3/d3.min.js"></script>
    <script src="../../static/js/d3/d3-tip.js"></script>
    <script src="../../static/js/select.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js'></script>

    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}"></script>
    <script src="../../static/js/selectize.min.js"></script>
    <script src="../../static/js/selectize_custom.js"></script>

    <link href="{{ url_for('static', filename='css/selectize.min.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/select.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/tracks.css') }}" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/genome_detail.css') }}" rel="stylesheet">
    {{ JSGlue.include() }}


{% endblock %}
{% block body %}

    <div class="container">

        <h4>Tag genomes as 'Simple'</h4>
        'Simple' means that they only contain at maximum one of each reference Profile.

        <br>
        <br>

        <form method="POST" enctype="multipart/form-data">
            {{ tag_simple_form.hidden_tag() }}

            <div class="smallform">


                {{ tag_simple_form.include_genome.label }}

                {{ tag_simple_form.include_genome() }}

                <br>
                <br>


                {{ tag_simple_form.exclude_hits.label }}

                {{ tag_simple_form.exclude_hits() }}

                <br>

                <br>


                {{ tag_simple_form.tag_simple(class="btn-primary") }}
            </div>
            <br>


        </form>

        <div>


            <div class="search_for_promoters_div">

        <h4>Search for promoters</h4>
            Search in the region directly before all the hits for a promoter sequence using this pattern - <br>
                (TTGACA.{15,25}TATAAT)
                <br>
                Meaning we must match TTGACA, then anything for 15 to 25 positions, then we must match TATAAT
                <br>
                You can add a number of mismatches you are willing to tolerate.


                <br>
                <br>

                <form method="POST" enctype="multipart/form-data">
                    {{ search_for_promoters_form.hidden_tag() }}

                    <div class="smallform">


                        {{ search_for_promoters_form.mismatch.label }}

                        {{ search_for_promoters_form.mismatch() }}

                        <br>
                        <br>


                        {{ search_for_promoters_form.search_for_promoters(class="btn-primary") }}
                    </div>
                    <br>


                </form>

                <button name="clear_all_promoters" class="btn-primary" id="clear_all_promoters"
                        type="submit">Clear all assigned promoters</button>

                <br>
                <br>
                <br>

                <br>


                <div>

                    <h4> Automatically change tags</h4>


                    WARNING: The following is an experimental feature. It updates tags on Genomes and doesn't update
                    tags on Regions
                    . However, it will update the tags on Genomes and Regions in the GenomeTags dictionary. In other
                    words, if
                    the tag you are changing has been tagged onto a Region then you must manually update the tag names
                    for
                    Regions in the Genome Detail view. Otherwise your GenomeTags dictionary will be out of sync with the
                    tags on
                    your Regions.

                    <br>
                    <br>

                    <form method="POST" enctype="multipart/form-data">
                        {{ update_tags_form.hidden_tag() }}

                        <div class="smallform">

                            {{ update_tags_form.old_tag.label }}

                            {{ update_tags_form.old_tag }}

                            <br>


                            {{ update_tags_form.new_tag.label }}

                            {{ update_tags_form.new_tag }}

                            <br>

                            {{ update_tags_form.update_tags(class="btn-primary") }}


                        </div>
                    </form>

                </div>

            </div>

        </div>
    </div>
    <script>

            $('#clear_all_promoters').on('click', function (e) {


            $.ajax({
                url: Flask.url_for("clear_all_promoters"),

                contentType: 'application/json;charset=UTF-8',
                type: 'POST',
                error: function (error) {
                    console.log(error);
                },
                success: function (response) {
                    flash('wowers')
                    window.location.reload();


                }
            });

        });

    </script>



{% endblock %}